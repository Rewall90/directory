// This is your Prisma schema file for Golf Directory
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  // extensions = [postgis] // Enable when PostGIS is available
}

// ============================================
// COURSES
// ============================================

model Course {
  id              String   @id @default(uuid())
  slug            String   @unique
  name            String
  formerName      String?  @map("former_name")

  // Address
  addressStreet   String   @map("address_street")
  addressArea     String?  @map("address_area")
  postalCode      String   @map("postal_code")
  city            String
  municipality    String
  region          String
  country         String   @default("Norway")

  // Coordinates
  latitude        Float?   @map("lat")
  longitude       Float?   @map("lng")
  coordinateAccuracy String? @map("coordinate_accuracy")

  // Course Details
  holes           Int
  holesPlayed     Int      @map("holes_played")
  par             Int?
  parPerRound     Int?     @map("par_per_round")

  // Par Breakdown
  par3Count       Int?     @map("par3_count")
  par4Count       Int?     @map("par4_count")
  par5Count       Int?     @map("par5_count")

  // Length
  lengthYards     Int?     @map("length_yards")
  lengthMeters    Int?     @map("length_meters")
  lengthNote      String?  @map("length_note") @db.Text

  // Course Info
  terrain         String?
  courseType      String?  @map("course_type")
  designer        String?
  yearBuilt       Int?     @map("year_built")
  yearRedesigned  Int?     @map("year_redesigned")
  description     String?  @db.Text

  // Signature/Scenic Holes
  waterHazards    Boolean? @map("water_hazards")
  signatureHole   String?  @map("signature_hole")
  scenicHole      String?  @map("scenic_hole")

  // Contact
  phone           String?
  email           String?
  emailAlt        String?  @map("email_alt")
  website         String?
  facebook        String?
  instagram       String?
  golfbox         Boolean? @default(false)

  // Season
  seasonStart     String?  @map("season_start")
  seasonEnd       String?  @map("season_end")
  visitorsWelcome Boolean? @map("visitors_welcome")
  walkingAllowed  Boolean? @map("walking_allowed")
  winterUse       String?  @map("winter_use")

  // Features
  mountainViews   Boolean? @map("mountain_views")
  viewDescription String?  @map("view_description") @db.Text
  nearbyCity      String?  @map("nearby_city")
  distanceFromCenter String? @map("distance_from_center")

  // Ownership
  courseCompany   String?  @map("course_company")
  clubOrganization String? @map("club_organization")

  // Metadata
  scrapedAt       DateTime @map("scraped_at")
  dataQuality     String?  @map("data_quality")
  websiteQuality  String?  @map("website_quality")
  completenessPercentage Int? @map("completeness_percentage")
  pagesScraped    Int?     @map("pages_scraped")

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  // Relations
  facilities         Facility?
  pricing            Pricing[]
  ratings            Rating[]
  courseRatings      CourseRating[]
  membershipPricing  MembershipPricing[]
  phoneNumbers       PhoneNumber[]
  sources            Source[]
  additionalFeatures AdditionalFeature[]
  courseRecords      CourseRecord[]
  nearbyCourses      NearbyCourse[]      @relation("CourseToNearby")
  nearbyOf           NearbyCourse[]      @relation("NearbyToCourse")
  sponsors           Sponsor[]

  @@index([region])
  @@index([slug])
  @@index([city])
  @@index([holes])
  @@index([par])
  @@map("courses")
}

// ============================================
// FACILITIES
// ============================================

model Facility {
  id              String   @id @default(uuid())
  courseId        String   @unique @map("course_id")
  course          Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  // Practice Facilities
  drivingRange    Boolean? @map("driving_range")
  drivingRangeLength Int?  @map("driving_range_length")
  puttingGreen    Boolean? @map("putting_green")
  chippingArea    Boolean? @map("chipping_area")
  practiceBunker  Boolean? @map("practice_bunker")

  // Club Facilities
  clubhouse       Boolean?
  clubhouseName   String?  @map("clubhouse_name")
  proShop         Boolean? @map("pro_shop")
  restaurant      Boolean?
  restaurantName  String?  @map("restaurant_name")

  // Rentals
  clubRental      Boolean? @map("club_rental")
  cartRental      Boolean? @map("cart_rental")
  pullCartRental  Boolean? @map("pull_cart_rental")

  // Instruction
  golfLessons     Boolean? @map("golf_lessons")
  teachingPro     Boolean? @map("teaching_pro")
  clubFitting     Boolean? @map("club_fitting")

  // Amenities
  lockerRooms     Boolean? @map("locker_rooms")
  showers         Boolean?
  lockerRental    Boolean? @map("locker_rental")

  // Events
  conferenceRoom  Boolean? @map("conference_room")
  eventVenue      Boolean? @map("event_venue")
  eventCapacity   Int?     @map("event_capacity")

  // Tech
  simulator       Boolean?
  simulatorType   String?  @map("simulator_type")
  simulatorCourses String? @map("simulator_courses")

  // Course Features
  bunkers         Int?

  // Alternative Sports
  footgolf        Boolean?
  footgolfHoles   Int?     @map("footgolf_holes")
  footgolfPar     Int?     @map("footgolf_par")
  tennis          Boolean?
  tennisCourts    Int?     @map("tennis_courts")
  discGolf        Boolean? @map("disc_golf")
  discGolfStandard String? @map("disc_golf_standard")

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@map("facilities")
}

// ============================================
// PRICING
// ============================================

model Pricing {
  id              String   @id @default(uuid())
  courseId        String   @map("course_id")
  course          Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  year            Int
  currency        String   @default("NOK")

  // Green Fees
  greenFeeDaily   Int?     @map("green_fee_daily")
  greenFeeWeekday Int?     @map("green_fee_weekday")
  greenFeeWeekend Int?     @map("green_fee_weekend")
  greenFeeSenior  Int?     @map("green_fee_senior")
  greenFeeJunior  Int?     @map("green_fee_junior")
  greenFeeDescription String? @map("green_fee_description") @db.Text

  // Rentals
  cartRental      Int?     @map("cart_rental")
  pullCartRental  Int?     @map("pull_cart_rental")
  clubRental      Int?     @map("club_rental")

  // Special Offers
  specialOfferPrice Int?   @map("special_offer_price")
  specialOfferIncludes String? @map("special_offer_includes") @db.Text

  // Other
  freeTrial       Boolean? @map("free_trial")
  notes           String?  @db.Text

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@unique([courseId, year])
  @@index([year])
  @@map("pricing")
}

// ============================================
// MEMBERSHIP PRICING
// ============================================

model MembershipPricing {
  id              String   @id @default(uuid())
  courseId        String   @map("course_id")
  course          Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  year            Int
  category        String   // "knotter", "junior", "student", "senior", "family", etc.
  price           Int
  description     String?  @db.Text
  ageRange        String?  @map("age_range") // "0-12", "13-19", "20-30", etc.

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@unique([courseId, year, category])
  @@index([year])
  @@map("membership_pricing")
}

// ============================================
// RATINGS & REVIEWS
// ============================================

model Rating {
  id              String   @id @default(uuid())
  courseId        String   @map("course_id")
  course          Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  source          String   // "hole19", "18birdies", "top100", "golfpass", "google", "facebook"
  rating          Float?
  reviewCount     Int?     @map("review_count")
  maxRating       Float?   @map("max_rating") @default(5.0)

  // Social Media Specific
  likes           Int?     // Facebook likes
  checkIns        Int?     @map("check_ins") // Facebook check-ins

  scrapedAt       DateTime @map("scraped_at")

  @@unique([courseId, source])
  @@index([source])
  @@map("ratings")
}

// ============================================
// COURSE RATINGS (Slope, Course Rating)
// ============================================

model CourseRating {
  id              String   @id @default(uuid())
  courseId        String   @map("course_id")
  course          Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  teeColor        String   @map("tee_color") // "Yellow", "White", "Red", "Blue", "Black"
  teeNumber       Int?     @map("tee_number") // 62, 58, 54, 49
  gender          String   // "men", "women"

  courseRating    Float?   @map("course_rating")
  slopeRating     Int?     @map("slope_rating")
  lengthYards     Int?     @map("length_yards")
  lengthMeters    Int?     @map("length_meters")
  par             Int?

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@unique([courseId, teeColor, gender])
  @@map("course_ratings")
}

// ============================================
// PHONE NUMBERS
// ============================================

model PhoneNumber {
  id              String   @id @default(uuid())
  courseId        String   @map("course_id")
  course          Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  phoneNumber     String   @map("phone_number")
  type            String?  // "main", "booking", "restaurant", "pro_shop"
  isPrimary       Boolean  @default(false) @map("is_primary")

  @@index([courseId])
  @@map("phone_numbers")
}

// ============================================
// SOURCES
// ============================================

model Source {
  id              String   @id @default(uuid())
  courseId        String   @map("course_id")
  course          Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  type            String   // "official_website", "google_maps", "18birdies", "hole19", etc.
  url             String?
  dataObtained    String[] @map("data_obtained")
  pagesScraped    Int?     @map("pages_scraped")
  scrapedAt       DateTime @map("scraped_at")

  @@index([courseId])
  @@map("sources")
}

// ============================================
// ADDITIONAL FEATURES
// ============================================

model AdditionalFeature {
  id              String   @id @default(uuid())
  courseId        String   @map("course_id")
  course          Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  feature         String
  description     String?  @db.Text

  @@index([courseId])
  @@map("additional_features")
}

// ============================================
// COURSE RECORDS
// ============================================

model CourseRecord {
  id              String   @id @default(uuid())
  courseId        String   @map("course_id")
  course          Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  gender          String   // "men", "women"
  score           Int
  underPar        Int      @map("under_par")
  playerName      String   @map("player_name")
  year            Int
  note            String?  @db.Text

  @@index([courseId])
  @@map("course_records")
}

// ============================================
// NEARBY COURSES
// ============================================

model NearbyCourse {
  id              String   @id @default(uuid())
  courseId        String   @map("course_id")
  nearbyCourseId  String   @map("nearby_course_id")

  course          Course   @relation("CourseToNearby", fields: [courseId], references: [id], onDelete: Cascade)
  nearbyCourse    Course   @relation("NearbyToCourse", fields: [nearbyCourseId], references: [id], onDelete: Cascade)

  distanceKm      Float?   @map("distance_km")

  @@unique([courseId, nearbyCourseId])
  @@index([courseId])
  @@index([nearbyCourseId])
  @@map("nearby_courses")
}

// ============================================
// SPONSORS
// ============================================

model Sponsor {
  id              String   @id @default(uuid())
  courseId        String   @map("course_id")
  course          Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  name            String
  logo            String?
  website         String?
  holeNumber      Int?     @map("hole_number")

  @@index([courseId])
  @@map("sponsors")
}
